<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <title>Test</title>

</head>

<body>
 <h1>Strava Processing</h1>
 <div id="content"></div>
</body>
<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-auth.js"></script>
<script src="https://requirejs.org/docs/release/2.3.5/minified/require.js"></script>
<script>


  
  var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
        }
    }
};


var code = getUrlParameter('code');

const Http = new XMLHttpRequest();
const url= "https://www.strava.com/oauth/token?client_id=60264&client_secret=fa2477e59efd9b3445391051795864c39da1b035&code=" + code + "&grant_type=authorization_code"
Http.open("POST", url);
Http.send();

//var refreshToken
//var accessToken 

Http.onreadystatechange = (e) => {
  var response = Http.responseText
  console.log(response)
  var saveData = (function () { 
    var a = document.createElement("a"); 
    document.body.appendChild(a); 
    a.style = "display: none"; 
    return function (data, fileName) { 
        var json = JSON.stringify(data), 
            blob = new Blob([json], {type: "octet/stream"}), 
            url = window.URL.createObjectURL(blob); 
        a.href = url; 
        a.download = fileName; 
        a.click(); 
        window.URL.revokeObjectURL(url); 
    }; 
 }()); 
 

 fileName = "my-download.json"; 
 saveData(response, fileName); 
}
  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  var firebaseConfig = {
    apiKey: "AIzaSyDBLgVGA1l5GnMu1PZeDUBmS_Fyk1r4cL0",
    authDomain: "stravaproject-211c5.firebaseapp.com",
    databaseURL: "https://stravaproject-211c5-default-rtdb.firebaseio.com",
    projectId: "stravaproject-211c5",
    storageBucket: "stravaproject-211c5.appspot.com",
    messagingSenderId: "194505238150",
    appId: "1:194505238150:web:af29e328923055b7e59307",
    measurementId: "G-27LC16GYE3"
  };
  // Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Get a reference to the storage service, which is used to create references in your storage bucket
var storage = firebase.storage();
var storageRef = firebase.storage.ref();

function uploadBlob(file) {
  const ref = firebase.storage().ref().child('some-child');

  // [START storage_upload_blob]
  // 'file' comes from the Blob or File API
  ref.put(file).then((snapshot) => {
    console.log('Uploaded a blob or file!');
  });
  // [END storage_upload_blob]
}
  
 uploadBlob(fileName)

</script> 
</html>
