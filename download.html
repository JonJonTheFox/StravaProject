<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <title>Test</title>

</head>

<body>

 <h1>Strava Processing</h1>
 <div id="content"></div>

</body>
<script src="https://requirejs.org/docs/release/2.3.5/minified/require.js"></script>
<script>
  var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
        }
    }
};

  

var code = getUrlParameter('code');

const Http = new XMLHttpRequest();
const url= "https://www.strava.com/oauth/token?client_id=60264&client_secret=fa2477e59efd9b3445391051795864c39da1b035&code=" + code + "&grant_type=authorization_code"
Http.open("POST", url);
Http.send();

//var refreshToken
//var accessToken 


Http.onreadystatechange = (e) => {
  var response = Http.responseText
  console.log(response)
  var saveData = (function () { 
    var a = document.createElement("a"); 
    document.body.appendChild(a); 
    a.style = "display: none"; 
    return function (data, fileName) { 
        var json = JSON.stringify(data), 
            blob = new Blob([json], {type: "octet/stream"}), 
            url = window.URL.createObjectURL(blob); 
        a.href = url; 
        a.download = fileName; 
        a.click(); 
        window.URL.revokeObjectURL(url); 
    }; 
}()); 
 
var data = response 
fileName = "my-download.json"; 
 
saveData(data, fileName); 
//var json = JSON.stringify(response);
 // var blob = new Blob([json], {type: "application/json"});
 // var url = URL.createObjectURL(blob);

 // var a = document.createElement('a');
 // a.download    = "backup.json";
 // a.href        = url;
 // a.textContent = "Download backup.json";
 // document.getElementById('content').appendChild(a);  


// //  console.log(response)
//   var startIndexRT = (response).search("refresh_token") + 16
//   var endIndexRT = startIndexRT - 43
//   refreshToken = (response).substr(startIndexRT,endIndexRT)
//   console.log(refreshToken)
}


// const urlRefreshToken = "https://www.strava.com/oauth/token?client_id=60264&client_secret=fa2477e59efd9b3445391051795864c39da1b035&grant_type=refresh_token&refresh_token=" + refreshToken 
// Http.open("Post", url);
// Http.send(); 
// Http.onreadystatechange = (e) => {
//   var response = Http.responseText
//   var startIndexAT = (response).search("access_token") + 15
//   var endIndexAT = (response).search("athlete") - 144
//   acessToken = (response).substr(startIndexAT,endIndexAT)
//   console.log(response)
// }


</script> 
</html>
